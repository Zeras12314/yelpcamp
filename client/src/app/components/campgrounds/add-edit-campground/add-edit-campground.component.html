<section class="container add-edit-container py-5">

  <form [formGroup]="campgroundForm" class="bg-glass glass-form mx-auto" enctype="multipart/form-data"
    style="max-width: 720px;">
    <h2 class="text-center mb-4">{{ btnLabel }} Campground</h2>

    <!-- Title & Price -->
    <div class="row g-3">
      <div class="col-12 col-md-8">
        <label for="title" class="form-label">Title</label>
        <input id="title" type="text" formControlName="title" class="form-control glass-input"
          placeholder="Enter title" />
        @if(campgroundForm.controls['title'].invalid && campgroundForm.controls['title'].touched){
        <small class="text-danger">Title is required.</small>
        }
      </div>

      <div class="col-12 col-md-4">
        <label for="price" class="form-label">Price ($)</label>
        <input id="price" type="number" formControlName="price" class="form-control glass-input" placeholder="0" />
        @if(campgroundForm.controls['price'].invalid && campgroundForm.controls['price'].touched){
        <small class="text-danger">Price is required.</small>
        }
      </div>
    </div>

    <!-- Description -->
    <div class="mt-3">
      <label for="description" class="form-label">Description</label>
      <textarea id="description" formControlName="description" rows="5" class="form-control glass-input"
        placeholder="Enter description"></textarea>
      @if(campgroundForm.controls['description'].invalid && campgroundForm.controls['description'].touched){
      <small class="text-danger">Description is required.</small>
      }
    </div>

    <!-- Location -->
    <div class="mt-3">
      <label for="location" class="form-label">Location</label>
      <input id="location" type="text" formControlName="location" class="form-control glass-input"
        placeholder="Enter location" />
      @if(campgroundForm.controls['location'].invalid && campgroundForm.controls['location'].touched){
      <small class="text-danger">Location is required.</small>
      }
    </div>

    <!-- Image Upload -->
    <div class="mt-3">
      <label for="image" class="form-label">Upload Images</label>
      <input type="file" class="form-control glass-input" name="image" accept="image/*" multiple
        (change)="onFileSelected($event)" />
      @if(showFileUploadValidation){
      <small class="text-danger">Please upload at least one image.</small>}
    </div>

    <!-- Image Preview -->
    @if(campImages?.length){
    <div class="row g-3 mt-3">
      @for(img of campImages; track $index){
      <div class="col-6 col-md-4 col-lg-3 text-center">
        <img [src]="img.thumbnail" class="img-fluid img-thumbnail glass-thumb mb-2" />

        <div class="form-check">
          <input class="form-check-input" type="checkbox" [id]="'image-' + $index" [value]="img.filename"
            [disabled]="isEmptyImage()" (change)="onDeleteToggle($event)" />
          <label class="form-check-label" [for]="'image-' + $index">
            Delete
          </label>
        </div>
      </div>
      }
    </div>
    }

    <!-- Actions -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mt-4">
      <div>
        @if(id){
        <a [routerLink]="['/campground-details', id]" class="glass-link">
          Back to {{ campgroundForm.get('title')?.value }}
        </a>
        } @else {
        <a [routerLink]="['/campgrounds']" class="glass-link">
          Back to Campgrounds
        </a>
        }
      </div>

      <button type="submit" class="flame-cta-fill" [disabled]="campgroundForm.pristine" (click)="onSubmit()">
        @if (!(loading$ | async)) {
        {{ btnLabel }} Campground
        } @else {
        <span class="spinner-border spinner-border-sm me-2"></span>
        Processing...
        }
      </button>
    </div>

  </form>
</section>